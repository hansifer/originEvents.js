// originEvents.js 0.1.0
// https://github.com/hansifer/originEvents.js
// (c) 2013-2014 Hans Meyer; Licensed MIT

(function(undefined) {var _=_||underscoreInit.call(this),uuid=uuid||uuidInit.call(this);


(function(){var a,b=this,c=0,d="originEvents.nooxis.com.",e=d+uuid.v4()+".",f=new RegExp("^"+d.replace(".","\\.")+"[0-9a-f]{32}\\.\\d+$"),g={},h="0.1.0",i=0,j=function(b){var c;b.newValue&&f.test(b.key)&&b.key.substring(0,e.length)!==e&&(c=a.decodeValue(b.newValue),k(c.type,c.message,c.datetime,!0,b.key))},k=function(a,b,c,d,e){_.each(g[a],function(f){("all"===f.s||"remote"===f.s&&d||"local"===f.s&&!d)&&f.h(a,b,c,d,e)})},l=function(a,c,d){d="local"===d&&"local"||"remote"===d&&"remote"||"all",a in g||(g[a]=[]),g[a].push({h:c,s:d}),("remote"===d||"all"===d)&&(i||b.addEventListener("storage",j,!1),i++)},m=function(a,c){var d,e;a in g&&(c?(e=_.find(g[a],function(a,b){return a.h===c?(d=b,!0):!1}),_.isUndefined(d)||(!i||"remote"!==e.s&&"all"!==e.s||(i=Math.max(i-1,0),i||b.removeEventListener("storage",j,!1)),g[a].splice(d,1))):(i&&(_.each(g[a],function(a){("remote"===a.s||"all"===a.s)&&(i=Math.max(i-1,0))}),i||b.removeEventListener("storage",j,!1)),delete g[a]))},n=function(b,d){var f=e+c++,g=new Date;return this.canEmitRemotely()&&(a.set(f,{datetime:g,type:b,message:d}),localStorage.removeItem(f)),this.canEmitLocally()&&k(b,d,g,!1,f),f},o=function(a){return arguments.length&&(this._l=a),this._l},p=function(a){return arguments.length&&(this._r=a),this._r},q=function(c,d){var e={};return e.on=l,e.off=m,e.trigger=n,e.canEmitLocally=o,e.canEmitRemotely=p,e.version=h,e.canEmitLocally(_.isUndefined(c)||c),e.canEmitRemotely(_.isUndefined(d)||d),a||(a=!0,a=b.snorkelInit(!1,!1)),e};b.originEventsInit=q}).call(this);

//!     Underscore.js 1.5.1
//!     http://underscorejs.org
//!     (c) 2009-2013 Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
//!     Underscore may be freely distributed under the MIT license.
//!
function underscoreInit(){var a={},b=Array.prototype,c=Object.prototype,d=Function.prototype,e=b.push,f=b.slice,g=b.concat,h=c.toString,i=c.hasOwnProperty,j=b.forEach,k=b.map,l=b.filter,m=b.every,n=b.some,o=b.indexOf,p=b.lastIndexOf,q=Array.isArray,r=Object.keys,s=d.bind,t=function(a){return a instanceof t?a:this instanceof t?(this._wrapped=a,void 0):new t(a)};t.VERSION="1.5.1";var u=t.each=t.forEach=function(b,c,d){if(null!=b)if(j&&b.forEach===j)b.forEach(c,d);else if(b.length===+b.length){for(var e=0,f=b.length;f>e;e++)if(c.call(d,b[e],e,b)===a)return}else for(var g=t.keys(b),e=0,f=g.length;f>e;e++)if(c.call(d,b[g[e]],g[e],b)===a)return};t.map=t.collect=function(a,b,c){var d=[];return null==a?d:k&&a.map===k?a.map(b,c):(u(a,function(a,e,f){d.push(b.call(c,a,e,f))}),d)},t.find=t.detect=function(a,b,c){var d;return v(a,function(a,e,f){return b.call(c,a,e,f)?(d=a,!0):void 0}),d},t.filter=t.select=function(a,b,c){var d=[];return null==a?d:l&&a.filter===l?a.filter(b,c):(u(a,function(a,e,f){b.call(c,a,e,f)&&d.push(a)}),d)},t.every=t.all=function(b,c,d){c||(c=t.identity);var e=!0;return null==b?e:m&&b.every===m?b.every(c,d):(u(b,function(b,f,g){return(e=e&&c.call(d,b,f,g))?void 0:a}),!!e)};var v=t.some=t.any=function(b,c,d){c||(c=t.identity);var e=!1;return null==b?e:n&&b.some===n?b.some(c,d):(u(b,function(b,f,g){return e||(e=c.call(d,b,f,g))?a:void 0}),!!e)};t.contains=t.include=function(a,b){return null==a?!1:o&&a.indexOf===o?-1!=a.indexOf(b):v(a,function(a){return a===b})};var w=function(a){return t.isFunction(a)?a:function(b){return b[a]}};t.sortedIndex=function(a,b,c,d){c=null==c?t.identity:w(c);for(var e=c.call(d,b),f=0,g=a.length;g>f;){var h=f+g>>>1;c.call(d,a[h])<e?f=h+1:g=h}return f},t.size=function(a){return null==a?0:a.length===+a.length?a.length:t.keys(a).length},t.initial=function(a,b,c){return f.call(a,0,a.length-(null==b||c?1:b))};var x=function(a,b,c){return b&&t.every(a,t.isArray)?g.apply(c,a):(u(a,function(a){t.isArray(a)||t.isArguments(a)?b?e.apply(c,a):x(a,b,c):c.push(a)}),c)};t.flatten=function(a,b){return x(a,b,[])},t.uniq=t.unique=function(a,b,c,d){t.isFunction(b)&&(d=c,c=b,b=!1);var e=c?t.map(a,c,d):a,f=[],g=[];return u(e,function(c,d){(b?d&&g[g.length-1]===c:t.contains(g,c))||(g.push(c),f.push(a[d]))}),f},t.object=function(a,b){if(null==a)return{};for(var c={},d=0,e=a.length;e>d;d++)b?c[a[d]]=b[d]:c[a[d][0]]=a[d][1];return c},t.indexOf=function(a,b,c){if(null==a)return-1;var d=0,e=a.length;if(c){if("number"!=typeof c)return d=t.sortedIndex(a,b),a[d]===b?d:-1;d=0>c?Math.max(0,e+c):c}if(o&&a.indexOf===o)return a.indexOf(b,c);for(;e>d;d++)if(a[d]===b)return d;return-1},t.lastIndexOf=function(a,b,c){if(null==a)return-1;var d=null!=c;if(p&&a.lastIndexOf===p)return d?a.lastIndexOf(b,c):a.lastIndexOf(b);for(var e=d?c:a.length;e--;)if(a[e]===b)return e;return-1};var y=function(){};t.bind=function(a,b){var c,d;if(s&&a.bind===s)return s.apply(a,f.call(arguments,1));if(!t.isFunction(a))throw new TypeError;return c=f.call(arguments,2),d=function(){if(!(this instanceof d))return a.apply(b,c.concat(f.call(arguments)));y.prototype=a.prototype;var e=new y;y.prototype=null;var g=a.apply(e,c.concat(f.call(arguments)));return Object(g)===g?g:e}},t.keys=r||function(a){if(a!==Object(a))throw new TypeError("Invalid object");var b=[];for(var c in a)t.has(a,c)&&b.push(c);return b},t.values=function(a){for(var b=t.keys(a),c=b.length,d=new Array(c),e=0;c>e;e++)d[e]=a[b[e]];return d},t.invert=function(a){for(var b={},c=t.keys(a),d=0,e=c.length;e>d;d++)b[a[c[d]]]=c[d];return b},t.functions=t.methods=function(a){var b=[];for(var c in a)t.isFunction(a[c])&&b.push(c);return b.sort()},t.extend=function(a){return u(f.call(arguments,1),function(b){if(b)for(var c in b)a[c]=b[c]}),a},t.clone=function(a){return t.isObject(a)?t.isArray(a)?a.slice():t.extend({},a):a};var z=function(a,b,c,d){if(a===b)return 0!==a||1/a==1/b;if(null==a||null==b)return a===b;a instanceof t&&(a=a._wrapped),b instanceof t&&(b=b._wrapped);var e=h.call(a);if(e!=h.call(b))return!1;switch(e){case"[object String]":return a==String(b);case"[object Number]":return a!=+a?b!=+b:0==a?1/a==1/b:a==+b;case"[object Date]":case"[object Boolean]":return+a==+b;case"[object RegExp]":return a.source==b.source&&a.global==b.global&&a.multiline==b.multiline&&a.ignoreCase==b.ignoreCase}if("object"!=typeof a||"object"!=typeof b)return!1;for(var f=c.length;f--;)if(c[f]==a)return d[f]==b;var g=a.constructor,i=b.constructor;if(g!==i&&!(t.isFunction(g)&&g instanceof g&&t.isFunction(i)&&i instanceof i))return!1;c.push(a),d.push(b);var j=0,k=!0;if("[object Array]"==e){if(j=a.length,k=j==b.length)for(;j--&&(k=z(a[j],b[j],c,d)););}else{for(var l in a)if(t.has(a,l)&&(j++,!(k=t.has(b,l)&&z(a[l],b[l],c,d))))break;if(k){for(l in b)if(t.has(b,l)&&!j--)break;k=!j}}return c.pop(),d.pop(),k};t.isEqual=function(a,b){return z(a,b,[],[])},t.isEmpty=function(a){if(null==a)return!0;if(t.isArray(a)||t.isString(a))return 0===a.length;for(var b in a)if(t.has(a,b))return!1;return!0},t.isElement=function(a){return!(!a||1!==a.nodeType)},t.isArray=q||function(a){return"[object Array]"==h.call(a)},t.isObject=function(a){return a===Object(a)},u(["Arguments","Function","String","Number","Date","RegExp"],function(a){t["is"+a]=function(b){return h.call(b)=="[object "+a+"]"}}),t.isArguments(arguments)||(t.isArguments=function(a){return!(!a||!t.has(a,"callee"))}),"function"!=typeof/./&&(t.isFunction=function(a){return"function"==typeof a}),t.isFinite=function(a){return isFinite(a)&&!isNaN(parseFloat(a))},t.isNaN=function(a){return t.isNumber(a)&&a!=+a},t.isBoolean=function(a){return a===!0||a===!1||"[object Boolean]"==h.call(a)},t.isNull=function(a){return null===a},t.isUndefined=function(a){return void 0===a},t.has=function(a,b){return i.call(a,b)},t.identity=function(a){return a};var A={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;"}};A.unescape=t.invert(A.escape);var B={escape:new RegExp("["+t.keys(A.escape).join("")+"]","g"),unescape:new RegExp("("+t.keys(A.unescape).join("|")+")","g")};t.each(["escape","unescape"],function(a){t[a]=function(b){return null==b?"":(""+b).replace(B[a],function(b){return A[a][b]})}}),t.result=function(a,b){if(null==a)return void 0;var c=a[b];return t.isFunction(c)?c.call(a):c},t.mixin=function(a){u(t.functions(a),function(b){var c=t[b]=a[b];t.prototype[b]=function(){var a=[this._wrapped];return e.apply(a,arguments),C.call(this,c.apply(t,a))}})},t.chain=function(a){return t(a).chain()};var C=function(a){return this._chain?t(a).chain():a};return t.mixin(t),u(["pop","push","reverse","shift","sort","splice","unshift"],function(a){var c=b[a];t.prototype[a]=function(){var b=this._wrapped;return c.apply(b,arguments),"shift"!=a&&"splice"!=a||0!==b.length||delete b[0],C.call(this,b)}}),u(["concat","join","slice"],function(a){var c=b[a];t.prototype[a]=function(){return C.call(this,c.apply(this._wrapped,arguments))}}),t.extend(t.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}}),t}

function uuidInit(){function a(a,b){var c=b||0,d=j;return d[a[c++]]+d[a[c++]]+d[a[c++]]+d[a[c++]]+d[a[c++]]+d[a[c++]]+d[a[c++]]+d[a[c++]]+d[a[c++]]+d[a[c++]]+d[a[c++]]+d[a[c++]]+d[a[c++]]+d[a[c++]]+d[a[c++]]+d[a[c++]]}function b(b,d,e){var f=d&&e||0;"string"==typeof b&&(d="binary"==b?new i(16):null,b=null),b=b||{};var g=b.random||(b.rng||c)();if(g[6]=15&g[6]|64,g[8]=63&g[8]|128,d)for(var h=0;16>h;h++)d[f+h]=g[h];return d||a(g)}var c,d=this;if("function"==typeof d.require)try{var e=d.require("crypto").randomBytes;c=e&&function(){return e(16)}}catch(f){}if(!c&&d.crypto&&crypto.getRandomValues){var g=new Uint8Array(16);c=function(){return crypto.getRandomValues(g),g}}if(!c){var h=new Array(16);c=function(){for(var a,b=0;16>b;b++)0===(3&b)&&(a=4294967296*Math.random()),h[b]=a>>>((3&b)<<3)&255;return h}}for(var i="function"==typeof d.Buffer?d.Buffer:Array,j=[],k={},l=0;256>l;l++)j[l]=(l+256).toString(16).substr(1),k[j[l]]=l;var m=b;if(m.v4=b,m.unparse=a,m.BufferClass=i,"function"==typeof define&&define.amd)define(function(){return m});else{if("undefined"==typeof module||!module.exports)return m;module.exports=m}}

// snorkel.js 0.1.0
// https://github.com/hansifer/snorkel.js
// (c) 2013-2014 Hans Meyer; Licensed MIT
//
// Depends:
// underscore (https://github.com/jashkenas/underscore)
// originEvents (https://github.com/hansifer/originEvents.js)

(function(a){var b=this,c=b.localStorage,d={};d.snorkelInit=b.snorkelInit;var e,f,g=[],h="0.1.0",i=0,j=function(a){return _.isString(a)&&a.length||_.isFinite(a)},k=function(a){return _.isString(a)||_.isFinite(a)||_.isBoolean(a)||_.isObject(a)&&!_.isFunction(a)||_.isNull(a)||_.isUndefined(a)},l=function(a){if(!j(a))throw"snorkel invalid key "+A(a,"");return!0},m=function(a){if(!k(a))throw"snorkel invalid value "+A(a,"");return!0},n=function(a){return JSON.stringify(o(a))},o=function(a,b){var c,d,e;if(_.isDate(a))return"\\/Date("+a.toISOString()+")\\/";if(_.isRegExp(a))return"\\/RegExp("+a.source+")"+(a.global||a.ignoreCase||a.multiline?"("+(a.global?"g":"")+(a.ignoreCase?"i":"")+(a.multiline?"m":"")+")":"")+"\\/";if(_.isUndefined(a))return"\\/undefined\\/";if(_.isObject(a)){if(b){if(e=_.find(b,function(b){return b.orig===a}))return e.clone}else b=[];d=_.isArray(a)?[]:{},b.push({orig:a,clone:d});for(c in a)d[c]=o(a[c],b);return d}return a},p=function(a){if(""===a)return null;if("undefined"!==a)return q(JSON.parse(a))},q=function(b,c){var d;if(_.isString(b))return r(b)||s(b)||("\\/undefined\\/"===b?a:b);if(_.isObject(b)){if(c){if(_.contains(c,b))return b}else c=[];c.push(b);for(d in b)b[d]=q(b[d],c)}return b},r=function(a){return _.isString(a)&&"\\/Date("===a.substring(0,7)?new Date(a.substring(7,a.indexOf(")"))):void 0},s=function(a){var b,c;return _.isString(a)&&"\\/RegExp("===a.substring(0,9)?(b=a.indexOf(")",9),c=a.substring(9,b),b=a.indexOf("(",b),-1!==b?new RegExp(c,a.substring(b+1,a.indexOf(")",b))):new RegExp(c)):void 0},t=function(a){return G(a)?p(c.getItem(a)):void 0},u=function(a,b,d){var e;_.isUndefined(d)&&(d=n(b)),this.canEmitLocally()&&g.length||this.canEmitRemotely()?G(a)?(e=C(a),c.setItem(a,d),v.call(this,"updated",a,b,e)):(c.setItem(a,d),v.call(this,"added",a,b)):c.setItem(a,d)},v=function(a,b,c,d){j(b)&&(this.canEmitRemotely()&&f.trigger("snorkel",{type:a,key:b,value:c,oldValue:d}),this.canEmitLocally()&&w(a,b,c,d))},w=function(a,b,c,d,e){var f,h;for(b=b.toString(),f=0;f<g.length;f++){for(h=0;h<g[f].k.length&&(!g[f].k[h].test(b)||"updated"===a&&g[f].a!==!0&&_.isEqual(c,d)||!("all"===g[f].s||"remote"===g[f].s&&e||"local"===g[f].s&&!e));h++);(0===h||h<g[f].k.length)&&g[f].h(a,b,c,d,e)}},x=function(a){if(j(a))return new RegExp("^"+z(a)+"$");if(!_.isRegExp(a))throw"snorkel invalid key selector "+A(a,"");return a},y=function(a,b){w(b.type,b.key,b.value,b.oldValue,!0)},z=function(a){return a.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")},A=function(a,b){try{return _.isObject(a)?_.isFunction(a)?"[function]":_.isRegExp(a)?"[RegExp] "+a.source:JSON.stringify(a):a+""}catch(c){}return b},B=function(){var a,b=arguments.length;if(b>2)throw"snorkel call failed. 0-2 arguments expected, "+b+" present.";return b?(a=arguments[0],2===b?this.set(a,arguments[1]):!_.isObject(a)||_.isArray(a)||_.isRegExp(a)?C(a):this.set(a)):C()},C=function(a,b){var d,e;if(arguments.length>2)throw"snorkel get failed. 0-2 arguments required, "+arguments.length+" present.";if(!arguments.length){for(d={},e=0;e<c.length;e++)a=c.key(e),d[a]=C(a);return d}return _.isRegExp(a)?C(K(!0,a)):_.isArray(a)?_.flatten(_.map(a,function(a){return C(a,b)})):(l(a),_.isUndefined(b)||G(a)?t(a):_.isFunction(b)?b(a):b)},D=function(a,b){var c,d;if(1===arguments.length){if(!_.isObject(a)||_.isArray(a)||_.isRegExp(a))throw"snorkel set failed. Calling set() with a single argument requires a set object, but actual argument is "+A(a,"");return _.each(a,function(a,b){l(b),m(a)}),d=[],_.each(a,function(a,b){u.call(this,b,a),d.push(a)},this),d}if(2!==arguments.length)throw"snorkel set failed. A single set object or 2 arguments required, "+arguments.length+" present.";return m(b),_.isRegExp(a)?D.call(this,K(!0,a),b):(_.isArray(a)?(a=_.flatten(a),_.each(a,function(b,c){_.isRegExp(b)?a[c]=K(!0,b):l(b)}),a=_.uniq(_.flatten(a)),c=n(b),_.each(a,function(a){u.call(this,a,b,c)},this)):l(a)&&u.call(this,a,b),b)},E=function(a,b){var d;if(arguments.length>2)throw"snorkel remove failed. 0-2 arguments required, "+arguments.length+" present.";return arguments.length?_.isRegExp(a)?E.call(this,K(!0,a)):_.isArray(a)?(a=_.flatten(a),_.each(a,function(b,c){_.isRegExp(b)?a[c]=K(!0,b):l(b)}),a=_.uniq(_.flatten(a)),_.map(a,function(a){return this.remove(a,b)},this)):(l(a),d=C(a,b),G(a)&&(c.removeItem(a),(this.canEmitLocally()&&g.length||this.canEmitRemotely())&&v.call(this,"removed",a,d)),d):(d=M(),c.length&&(c.clear(),(this.canEmitLocally()&&g.length||this.canEmitRemotely())&&_.each(d,function(a,b){v.call(this,"removed",b,a)},this)),d)},F=function(){this.remove()},G=function(a){return!!K(!1,a,!0).length},H=function(b){return c.key(b)||a},I=function(){return c.length},J=function(a){var b,d;for(d=0;d<c.length;d++)b=c.key(d),a(b,C(b),d);return d},K=function(b,d,e,f){var g;if(f||(f=[]),1===arguments.length&&(_.isBoolean(b)||(d=b,b=a)),_.isArray(d)){for(g=0;g<d.length;g++)if(K(!1,d[g],e,f).length&&e)return f;f=_.uniq(_.flatten(f))}else{if(!(_.isUndefined(d)||_.isRegExp(d)||j(d)))throw"snorkel keys() failed. Not a valid key selector: "+A(d,"");for(g=0;g<c.length;g++){if(!d||_.isRegExp(d)&&d.test(c.key(g)))f.push(c.key(g));else if(j(d)&&d.toString()===c.key(g)){f.push(c.key(g));break}if(e&&f.length)return f}}return b?f.sort():f},L=function(){var a,b=[];for(a=0;a<c.length;a++)b.push(C(c.key(a)));return b},M=function(){return C()},N=function(a,b,c){if(arguments.length<1||arguments.length>3)throw"snorkel on() call failed. 1-3 arguments expected, "+arguments.length+" present.";if(!_.isFunction(a))throw"snorkel on() call failed. Expected function as first argument, received "+A(a,"");_.isUndefined(b)||(_.isArray(b)?(b=_.flatten(b),_.each(b,function(a,c){b[c]=x(a)})):b=x(b));var d=c&&("local"===c.scope&&"local"||"remote"===c.scope&&"remote")||"all",e=_.find(g,function(b){return b.h===a});e||g.push(e={s:d,a:!(!c||!c.alwaysFireOnUpdate),h:a,k:[]}),e.k=_.isUndefined(b)?[]:_.uniq(e.k.concat(b),function(a){return a.source+a.ignoreCase}),("remote"===d||"all"===d)&&(i||f.on("snorkel",y,"remote"),i++)},O=function(a){var b,c;_.isFunction(a)&&(c=_.find(g,function(c,d){return c.h===a?(b=d,!0):!1}),_.isUndefined(b)||(("remote"===c.s||"all"===c.s)&&(i--,i||f.off("snorkel",y)),g.splice(b,1)))},P=function(a){return arguments.length&&(this._canEmitLocally=a),this._canEmitLocally},Q=function(a){return arguments.length&&(this._canEmitRemotely=a),this._canEmitRemotely},R=function(a,c){var d=function(){return B.apply(d,arguments)};return d.get=C,d.set=D,d.remove=E,d.clear=F,d.exists=d.has=G,d.key=H,d.size=d.count=I,d.each=J,d.keys=K,d.values=L,d.all=d.items=M,d.on=d.addKeyListener=N,d.off=d.removeKeyListener=O,d.canEmitLocally=P,d.canEmitRemotely=Q,d.decodeValue=p,d.version=h,d.canEmitLocally(_.isUndefined(a)||a),d.canEmitRemotely(_.isUndefined(c)||c),f||(f=!0,f=b.originEventsInit(!1,!0)),d};for(e in d)b[e]=R}).call(this);

}).call(this);
