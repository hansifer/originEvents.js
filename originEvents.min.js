// originEvents.js 0.1.0
// https://github.com/hansifer/originEvents.js
// (c) 2013 Hans Meyer; Licensed MIT

(function(){var a,b=this,c=0,d="originEvents.nooxis.com.",e=d+uuid.v4()+".",f=new RegExp("^"+d.replace(".","\\.")+"[0-9a-f]{32}\\.\\d+$"),g={},h="0.1.0",i=0,j=function(b){var c;b.newValue&&f.test(b.key)&&b.key.substring(0,e.length)!==e&&(c=a.decodeValue(b.newValue),k(c.type,c.message,c.datetime,!0))},k=function(a,b,c,d){_.each(g[a],function(e){("all"===e.s||"remote"===e.s&&d||"local"===e.s&&!d)&&e.h(a,b,c,d)})},l=function(a,c,d){d="local"===d&&"local"||"remote"===d&&"remote"||"all",a in g||(g[a]=[]),g[a].push({h:c,s:d}),("remote"===d||"all"===d)&&(i||b.addEventListener("storage",j,!1),i++)},m=function(a,c){var d,e;a in g&&(c?(e=_.find(g[a],function(a,b){return a.h===c?(d=b,!0):!1}),_.isUndefined(d)||(!i||"remote"!==e.s&&"all"!==e.s||(i=Math.max(i-1,0),i||b.removeEventListener("storage",j,!1)),g[a].splice(d,1))):(i&&(_.each(g[a],function(a){("remote"===a.s||"all"===a.s)&&(i=Math.max(i-1,0))}),i||b.removeEventListener("storage",j,!1)),delete g[a]))},n=function(b,d){var f,g=new Date;this.canEmitRemotely()&&(a.set(f=e+c++,{datetime:g,type:b,message:d}),localStorage.removeItem(f)),this.canEmitLocally()&&k(b,d,g)},o=function(a){return arguments.length&&(this._l=a),this._l},p=function(a){return arguments.length&&(this._r=a),this._r},q=function(c,d){var e={};return e.on=l,e.off=m,e.trigger=n,e.canEmitLocally=o,e.canEmitRemotely=p,e.version=h,e.canEmitLocally(_.isUndefined(c)||c),e.canEmitRemotely(_.isUndefined(d)||d),a||(a=!0,a=b.snorkelInit(!1,!1)),e};b.originEventsInit=q}).call(this);